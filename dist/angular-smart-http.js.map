{"version":3,"sources":["angular-smart-http.js"],"names":[],"mappings":"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","file":"angular-smart-http.js","sourcesContent":["(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? factory() :\n  typeof define === 'function' && define.amd ? define(factory) :\n  factory();\n}(this, function () { 'use strict';\n\n  const prefix = 'SMHTTP_';\n  const expires = 5000;\n\n  const WINDOW = new WeakMap();\n\n  class Storage\n  {\n    constructor($window) {\n      WINDOW.set(this, $window);\n    }\n\n    get(key) {\n      return JSON.parse(this.getString(key));\n    }\n\n    set(key, value) {\n      this.setString(key, JSON.stringify(value));\n    }\n\n    getString(key) {\n      var now = new Date();\n      var entry = JSON.parse(WINDOW.get(this).localStorage.getItem(prefix + key));\n      console.log(now - new Date(entry.date));\n      if (now - new Date(entry.date) < expires) {\n        return entry.value;\n      } else {\n        //this.remove(key);\n        return null;\n      }\n    }\n\n    setString(key, value) {\n      var now = new Date();\n      var entry = JSON.stringify({\n        date: new Date(),\n        value: value\n      });\n      WINDOW.get(this).localStorage.setItem(prefix + key, entry);\n    }\n\n    static storageFactory($window) {\n      return new Storage($window);\n    }\n  }\n\n  const HTTP = new WeakMap();\n  const Q = new WeakMap();\n  const STORAGE = new WeakMap();\n\n  class SmartHttp\n  {\n    constructor($http, $rootScope, $q, Storage) {\n      HTTP.set(this, $http);\n      Q.set(this, $q);\n      STORAGE.set(this, Storage);\n    }\n\n    get(url) {\n      var key = 'GET' + url;\n      var fromStorageSync = STORAGE.get(this).get(key);\n      var fromStorage = Q.get(this).resolve(fromStorageSync);\n      var fromRemote = HTTP.get(this).get(url).then((data) => {\n        STORAGE.get(this).set(key, data);\n      });\n\n      if (fromStorageSync == null) {\n        fromStorage.$fresh = fromRemote;\n        return fromStorage;\n      } else {\n        fromRemote.$fresh = Q.get(this).resolve(false);\n        return fromRemote;\n      }\n      return deferred.promise;\n    }\n\n    static smartHttpFactory($http, $rootScope, $q, Storage) {\n      return new SmartHttp($http, $rootScope, $q, Storage);\n    }\n  }\n\n  var moduleName$1 = 'ngSmartHttp.services';\n\n  angular.module(moduleName$1, [])\n    .factory('SmartHttp', SmartHttp.smartHttpFactory)\n    .factory('Storage', Storage.storageFactory);\n\n  var moduleName = 'ngSmartHttp';\n\n  var app = angular.module(moduleName, [moduleName$1]);\n\n}));"],"sourceRoot":"/source/"}