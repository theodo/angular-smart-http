{"version":3,"sources":["angular-smart-http.min.js","/source/angular-smart-http.js"],"names":["_classCallCheck","instance","Constructor","TypeError","_createClass","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","protoProps","staticProps","prototype","global","factory","exports","module","define","amd","this","prefix","expires","WINDOW","WeakMap","Storage","$window","set","value","JSON","parse","getString","setString","stringify","now","Date","entry","get","localStorage","getItem","console","log","date","setItem","HTTP","Q","STORAGE","SmartHttp","$http","$rootScope","$q","url","_this","fromStorageSync","fromStorage","resolve","fromRemote","then","data","$fresh","moduleName$1","angular","smartHttpFactory","storageFactory","moduleName"],"mappings":"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","file":"angular-smart-http.min.js","sourcesContent":["var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }\n\n(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? factory() : typeof define === 'function' && define.amd ? define(factory) : factory();\n})(this, function () {\n  'use strict';\n\n  var prefix = 'SMHTTP_';\n  var expires = 5000;\n\n  var WINDOW = new WeakMap();\n\n  var Storage = (function () {\n    function Storage($window) {\n      _classCallCheck(this, Storage);\n\n      WINDOW.set(this, $window);\n    }\n\n    _createClass(Storage, [{\n      key: 'get',\n      value: function get(key) {\n        return JSON.parse(this.getString(key));\n      }\n    }, {\n      key: 'set',\n      value: function set(key, value) {\n        this.setString(key, JSON.stringify(value));\n      }\n    }, {\n      key: 'getString',\n      value: function getString(key) {\n        var now = new Date();\n        var entry = JSON.parse(WINDOW.get(this).localStorage.getItem(prefix + key));\n        console.log(now - new Date(entry.date));\n        if (now - new Date(entry.date) < expires) {\n          return entry.value;\n        } else {\n          //this.remove(key);\n          return null;\n        }\n      }\n    }, {\n      key: 'setString',\n      value: function setString(key, value) {\n        var now = new Date();\n        var entry = JSON.stringify({\n          date: new Date(),\n          value: value\n        });\n        WINDOW.get(this).localStorage.setItem(prefix + key, entry);\n      }\n    }], [{\n      key: 'storageFactory',\n      value: function storageFactory($window) {\n        return new Storage($window);\n      }\n    }]);\n\n    return Storage;\n  })();\n\n  var HTTP = new WeakMap();\n  var Q = new WeakMap();\n  var STORAGE = new WeakMap();\n\n  var SmartHttp = (function () {\n    function SmartHttp($http, $rootScope, $q, Storage) {\n      _classCallCheck(this, SmartHttp);\n\n      HTTP.set(this, $http);\n      Q.set(this, $q);\n      STORAGE.set(this, Storage);\n    }\n\n    _createClass(SmartHttp, [{\n      key: 'get',\n      value: function get(url) {\n        var _this = this;\n\n        var key = 'GET' + url;\n        var fromStorageSync = STORAGE.get(this).get(key);\n        var fromStorage = Q.get(this).resolve(fromStorageSync);\n        var fromRemote = HTTP.get(this).get(url).then(function (data) {\n          STORAGE.get(_this).set(key, data);\n        });\n\n        if (fromStorageSync == null) {\n          fromStorage.$fresh = fromRemote;\n          return fromStorage;\n        } else {\n          fromRemote.$fresh = Q.get(this).resolve(false);\n          return fromRemote;\n        }\n        return deferred.promise;\n      }\n    }], [{\n      key: 'smartHttpFactory',\n      value: function smartHttpFactory($http, $rootScope, $q, Storage) {\n        return new SmartHttp($http, $rootScope, $q, Storage);\n      }\n    }]);\n\n    return SmartHttp;\n  })();\n\n  var moduleName$1 = 'ngSmartHttp.services';\n\n  angular.module(moduleName$1, []).factory('SmartHttp', SmartHttp.smartHttpFactory).factory('Storage', Storage.storageFactory);\n\n  var moduleName = 'ngSmartHttp';\n\n  var app = angular.module(moduleName, [moduleName$1]);\n});\n//# sourceMappingURL=angular-smart-http.js.map\n","(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? factory() :\n  typeof define === 'function' && define.amd ? define(factory) :\n  factory();\n}(this, function () { 'use strict';\n\n  const prefix = 'SMHTTP_';\n  const expires = 5000;\n\n  const WINDOW = new WeakMap();\n\n  class Storage\n  {\n    constructor($window) {\n      WINDOW.set(this, $window);\n    }\n\n    get(key) {\n      return JSON.parse(this.getString(key));\n    }\n\n    set(key, value) {\n      this.setString(key, JSON.stringify(value));\n    }\n\n    getString(key) {\n      var now = new Date();\n      var entry = JSON.parse(WINDOW.get(this).localStorage.getItem(prefix + key));\n      console.log(now - new Date(entry.date));\n      if (now - new Date(entry.date) < expires) {\n        return entry.value;\n      } else {\n        //this.remove(key);\n        return null;\n      }\n    }\n\n    setString(key, value) {\n      var now = new Date();\n      var entry = JSON.stringify({\n        date: new Date(),\n        value: value\n      });\n      WINDOW.get(this).localStorage.setItem(prefix + key, entry);\n    }\n\n    static storageFactory($window) {\n      return new Storage($window);\n    }\n  }\n\n  const HTTP = new WeakMap();\n  const Q = new WeakMap();\n  const STORAGE = new WeakMap();\n\n  class SmartHttp\n  {\n    constructor($http, $rootScope, $q, Storage) {\n      HTTP.set(this, $http);\n      Q.set(this, $q);\n      STORAGE.set(this, Storage);\n    }\n\n    get(url) {\n      var key = 'GET' + url;\n      var fromStorageSync = STORAGE.get(this).get(key);\n      var fromStorage = Q.get(this).resolve(fromStorageSync);\n      var fromRemote = HTTP.get(this).get(url).then((data) => {\n        STORAGE.get(this).set(key, data);\n      });\n\n      if (fromStorageSync == null) {\n        fromStorage.$fresh = fromRemote;\n        return fromStorage;\n      } else {\n        fromRemote.$fresh = Q.get(this).resolve(false);\n        return fromRemote;\n      }\n      return deferred.promise;\n    }\n\n    static smartHttpFactory($http, $rootScope, $q, Storage) {\n      return new SmartHttp($http, $rootScope, $q, Storage);\n    }\n  }\n\n  var moduleName$1 = 'ngSmartHttp.services';\n\n  angular.module(moduleName$1, [])\n    .factory('SmartHttp', SmartHttp.smartHttpFactory)\n    .factory('Storage', Storage.storageFactory);\n\n  var moduleName = 'ngSmartHttp';\n\n  var app = angular.module(moduleName, [moduleName$1]);\n\n}));"],"sourceRoot":"/source/"}